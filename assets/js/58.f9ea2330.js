(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{369:function(v,_,t){"use strict";t.r(_);var a=t(0),r=Object(a.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h2",{attrs:{id:"订单-参数校验-哪些"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订单-参数校验-哪些"}},[v._v("#")]),v._v(" 订单 参数校验 哪些")]),v._v(" "),t("ol",[t("li",[v._v("商品 无货")]),v._v(" "),t("li",[v._v("商品最大购买数量 总数量限制")]),v._v(" "),t("li",[v._v("SKU 不能超过5件 1件")]),v._v(" "),t("li",[v._v("totalPrice")]),v._v(" "),t("li",[v._v("finalTotalPrice")]),v._v(" "),t("li",[v._v("是否拥有这个优惠券")]),v._v(" "),t("li",[v._v("优惠券是否过期")])]),v._v(" "),t("h2",{attrs:{id:"价格参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#价格参数"}},[v._v("#")]),v._v(" 价格参数")]),v._v(" "),t("p",[v._v("前端 计算的订单价格\n计算的订单折扣价（最终价）")]),v._v(" "),t("p",[v._v("服务端 计算订单的价格\n计算订单的折扣价")]),v._v(" "),t("h2",{attrs:{id:"浮点数运算"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浮点数运算"}},[v._v("#")]),v._v(" 浮点数运算")]),v._v(" "),t("p",[v._v("JS 0.1*0.85 = 0.08518787878787")]),v._v(" "),t("p",[v._v("解决思路：小数->整数，然后除以相同的倍数->小数")]),v._v(" "),t("p",[v._v('Java BigDecimal("0.1"):传入字符串')]),v._v(" "),t("h2",{attrs:{id:"取舍问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#取舍问题"}},[v._v("#")]),v._v(" 取舍问题")]),v._v(" "),t("p",[v._v("99.87 * 0.85 = 84.8895")]),v._v(" "),t("p",[v._v("保留两位：")]),v._v(" "),t("p",[v._v("平台赚钱：向上取整 进一 89.8895 = 89.89"),t("br"),v._v("\n平台亏钱：直接舍去 89.88"),t("br"),v._v("\n四舍五入：有赚有亏"),t("br"),v._v("\n四舍六入：重点在对于5的处理")]),v._v(" "),t("p",[v._v("绝对精确：平衡  舍去 多赚 平衡（四舍五入达不到，四舍六入可以）")]),v._v(" "),t("p",[v._v("对于平台来说亏多少赚多少取决的因素："),t("br"),v._v("\n成交额 1年成交金额  10亿 1笔\n订单数量 1年的订单数量 10亿笔 1块一笔")]),v._v(" "),t("p",[v._v("银行家算法")]),v._v(" "),t("p",[v._v("四舍六入五考虑，五后非空就进一，五后为空看奇偶，五前为偶应舍去，五前为\n奇要进一")]),v._v(" "),t("h2",{attrs:{id:"带有使用分类限制的优惠券校验"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#带有使用分类限制的优惠券校验"}},[v._v("#")]),v._v(" 带有使用分类限制的优惠券校验")]),v._v(" "),t("p",[v._v("A 鞋子和包包")]),v._v(" "),t("p",[v._v("1000 500")]),v._v(" "),t("p",[v._v("订单\nTotalPrice: 1600")]),v._v(" "),t("p",[v._v("CategoryTotalPrice 800 1000")]),v._v(" "),t("h2",{attrs:{id:"多分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#多分类"}},[v._v("#")]),v._v(" 多分类")]),v._v(" "),t("p",[v._v("鞋子")]),v._v(" "),t("p",[v._v("Order 鞋子 SKU actualPrice * count = Sku1 Price")]),v._v(" "),t("p",[v._v("Sku1Price + Sku2Price ....")]),v._v(" "),t("p",[v._v("包包")]),v._v(" "),t("p",[v._v("牛仔裤")]),v._v(" "),t("p",[v._v("for\nCategory1Price + Category2Price...\nfor\nSku1Price + Sku2Price...")]),v._v(" "),t("p",[v._v("reduce")]),v._v(" "),t("h2",{attrs:{id:"扣减库存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#扣减库存"}},[v._v("#")]),v._v(" 扣减库存")]),v._v(" "),t("ol",[t("li",[t("p",[v._v("正常")])]),v._v(" "),t("li",[t("p",[v._v("负数")])]),v._v(" "),t("li",[t("p",[v._v("报错（库存不足）")])]),v._v(" "),t("li",[t("p",[v._v("加锁 排队")])])]),v._v(" "),t("p",[v._v("数据库加锁 Java加锁")]),v._v(" "),t("ol",[t("li",[t("p",[v._v("Java加锁（不推荐）")])]),v._v(" "),t("li",[t("p",[v._v("数据库 锁 悲观锁(高并发对于数据库性能消耗比较大，还有可能锁表，不推荐)")]),v._v(" "),t("p",[v._v("1)开启事务"),t("br"),v._v("\n2)select ... sku.stock for update"),t("br"),v._v("\n3)update set stock - count\n4)commit")])]),v._v(" "),t("li",[t("p",[v._v("乐观锁 没有实际锁 并发竞态 思想")])])]),v._v(" "),t("h2",{attrs:{id:"orderstatus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#orderstatus"}},[v._v("#")]),v._v(" OrderStatus")]),v._v(" "),t("p",[v._v("Unpaid\nCanceled")]),v._v(" "),t("p",[v._v("CreateTime 订单创建时间\nPay-Time-Limit 3600")]),v._v(" "),t("ol",[t("li",[v._v("EndTime 写入Order")])]),v._v(" "),t("p",[v._v("now <= endTime\nnow > endTime")]),v._v(" "),t("h2",{attrs:{id:"微信支付"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#微信支付"}},[v._v("#")]),v._v(" 微信支付")]),v._v(" "),t("ol",[t("li",[v._v("企业资质小程序")]),v._v(" "),t("li",[v._v("商户号")])]),v._v(" "),t("p",[v._v("Payment API")]),v._v(" "),t("p",[v._v("V3 V2")]),v._v(" "),t("h2",{attrs:{id:"订单支付"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#订单支付"}},[v._v("#")]),v._v(" 订单支付")]),v._v(" "),t("ol",[t("li",[v._v("一气呵成 PlaceOrder OID 立即拉起支付 -> 支付")]),v._v(" "),t("li",[v._v("历史订单（未过期）二次、三次、N次支付，1小时 59分59秒服务器。")]),v._v(" "),t("li",[v._v("PostMan 发起支付 Button置灰")])]),v._v(" "),t("h2",{attrs:{id:"外网ip解决方案"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#外网ip解决方案"}},[v._v("#")]),v._v(" 外网IP解决方案")]),v._v(" "),t("p",[v._v("dev\n上线 云端服务器 租用 ECS 外网IP\n调试不方便")]),v._v(" "),t("p",[v._v("Ngrok "),t("a",{attrs:{href:"https://dashboard.ngrok.com/get-started/tutorials",target:"_blank",rel:"noopener noreferrer"}},[v._v("官网"),t("OutboundLink")],1),v._v("内网穿透")]),v._v(" "),t("h2",{attrs:{id:"延迟消息队列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#延迟消息队列"}},[v._v("#")]),v._v(" 延迟消息队列")]),v._v(" "),t("p",[v._v("取代 定时器")]),v._v(" "),t("p",[v._v("订单状态 过期")]),v._v(" "),t("p",[v._v("Coupon 没有明确的过期标识 Status\n真实存在\n查询 时间限制")]),v._v(" "),t("p",[v._v("不好触发")]),v._v(" "),t("p",[v._v("Order 需要明确的过期标识")]),v._v(" "),t("p",[v._v("只是查询则，不需要 利用ExpiredTime判断")]),v._v(" "),t("p",[v._v("unpaid -> 取消")]),v._v(" "),t("h2",{attrs:{id:"库存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#库存"}},[v._v("#")]),v._v(" 库存")]),v._v(" "),t("p",[v._v("下单 并不代表支付  延迟支付")]),v._v(" "),t("p",[v._v("预扣除库存"),t("br"),v._v("\n支付时间到了，未支付 归还库存 Stock")]),v._v(" "),t("ol",[t("li",[t("p",[v._v("如何归还？")])]),v._v(" "),t("li",[t("p",[v._v("什么时间归还？")])]),v._v(" "),t("li",[t("p",[v._v("谁来触发归还库存的操作？")]),v._v(" "),t("p",[v._v("1）.  主动轮询/其他应用  不够精确（订单30分钟过期，如何在这个点准确的执行？1s钟执行一次？浪费性能）")]),v._v(" "),t("p",[v._v("定时器 -> 1s 数据库到期的订单 归还库存 1小时 10分钟？误差较大")]),v._v(" "),t("p",[v._v("Timer"),t("br"),v._v("\nCorntab"),t("br"),v._v("\n定时任务框架  Quartz")]),v._v(" "),t("p",[v._v("2）. 被动触发")]),v._v(" "),t("p",[v._v("用户触发"),t("br"),v._v("\n过期时间  类似用户/角色")]),v._v(" "),t("p",[v._v("3）. 队列")]),v._v(" "),t("p",[v._v("先进先出，RocketMQ，RabbitMQ，Kafka")]),v._v(" "),t("p",[v._v("系统 取  队列主动返回给我们")]),v._v(" "),t("p",[v._v("4）. 延迟消息队列\nRedis（轻、不可靠）、RocketMQ（内存消耗大、可靠）、RabbitMQ（需要另装插件）")])])])])}),[],!1,null,null,null);_.default=r.exports}}]);